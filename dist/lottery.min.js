"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e,t={},n={timeout:null,once:!1,title:"name",subtitle:null,api:null,confetti:!0,showbtn:!0,el:"body",speed:350,data:{},winners:[],winnerList:[],winnerHistory:[],number:1,_round:0,$el:null},r={shape:"circle"},o={},a="<i class='dh-icon dh-icon-dice'>ðŸŽ²<svg><use xlink:href='#dh-dice'/></svg></i>",i=function(n){var r=$("      <svg xmlns='http://www.w3.org/2000/svg' style='display: none;'>        <symbol id='dh-okay' viewBox='0 0 57 92'>          <path fill='currentColor' fill-rule='nonzero' d='M3.6 51c2.5-1 5.2.3 6.2 2.7 1.3 3.5 4.6 5.8 8.3 5.8 5 0 9.2-4 9.2-9s-4-9-9-9c-3.8 0-7 2.2-8.4 5.6C8.8 49.7 6 51 3.6 50c-2.4-1-3.6-3.7-2.6-6C3.8 36.4 10.5 32 18 32c3.5 0 6.7 1 9.5 2.5l-8.8-22c-1-2.5.3-5.2 2.7-6.2 2.4-1 5.2.3 6 2.7L37 32.4 33.4 6.2c-.3-2.5 1.5-5 4-5.3 2.7-.4 5 1.4 5.4 4L46 29.7l1-11c.2-2.7 2.5-4.7 5-4.4 2.7.2 4.7 2.5 4.4 5l-3.6 41-4 30.8h-29l4.8-23.3c-2 .8-4.2 1.2-6.5 1.2C10.6 69 4 64.2 1 57c-1-2.4.2-5.2 2.6-6z'/>        </symbol>        <symbol id='dh-crown' viewBox='0 0 88 81'>          <path fill='currentColor' fill-rule='nonzero' d='M83 23c-2.6 0-4.8 2.3-4.8 5 0 1.6.8 3 2 4L69.6 48.2l-4-27.8c2.5-.3 4.3-2.3 4.3-4.7 0-2.7-2.2-4.8-4.8-4.8-2.7 0-4.8 2-4.8 4.8 0 2 1.3 3.8 3 4.4l-8 22-9.8-32c2-.6 3.4-2.4 3.4-4.6C48.8 3 46.6.8 44 .8c-2.6 0-4.8 2.2-4.8 4.8 0 2.2 1.4 4 3.4 4.6l-9.8 32-8-22c1.8-.6 3-2.4 3-4.4 0-2.7-2-4.8-4.7-4.8-2.6 0-4.7 2-4.7 4.8 0 2.4 1.8 4.3 4 4.7l-3.8 27.8-11-16.5c1.4-.8 2.3-2.3 2.3-4C9.8 25.2 7.6 23 5 23 2.4 23 .2 25.2.2 27.8c0 2.7 2.2 4.8 4.8 4.8.4 0 .8 0 1.2-.2l9.7 41s18.6-1.6 28-1.6c9.4 0 28 1.6 28 1.6L82 32.6H83c2.6 0 4.8-2 4.8-4.7s-2.2-5-4.8-5zM26 62.7c-2 0-3.6-1.6-3.6-3.5 0-2 1.6-3.5 3.6-3.5s3.6 1.6 3.6 3.6-1.6 3.6-3.6 3.6zm18 2.2c-3.2 0-5.8-2.5-5.8-5.7 0-3 2.6-5.7 5.8-5.7 3.2 0 5.8 2.6 5.8 5.8 0 3.3-2.6 5.8-5.8 5.8zm18-2.2c-2 0-3.6-1.6-3.6-3.5 0-2 1.6-3.5 3.6-3.5s3.6 1.6 3.6 3.6-1.6 3.6-3.6 3.6z'/>        </symbol>        <symbol id='dh-dice' viewBox='0 0 90 76'>          <path fill='currentColor' fill-rule='nonzero' d='M83.6 34.5c-1-.4-2.2 0-2.6 1-.4 1 0 2.3 1 2.7 4.4 1.7 4 3.2 3.6 4-.5 1.8-5.8 4-12.7 5.3l8.7-15.2c1.7-3 .7-6.7-2.3-8.4L39.7 1c-3-1.8-6.7-.7-8.5 2.2L10.8 38.6c-4.4-1.4-6.6-3-6.6-4 0-2 2.6-4.3 9.8-6 1-.2 1.8-1.3 1.6-2.4-.3-1-1.4-1.8-2.4-1.5C1.8 27.3.2 32 .2 34.5c0 7 14 9.5 21.7 10.4 0-.2 0-.3-.2-.5-.8-3 1-6 4-6.7 2.8-.8 5.8 1 6.6 4 .8 2.8-1 5.8-4 6.6-2 .6-4.3-.3-5.6-2-.5.5-1 .8-1.8.7-5.4-.4-9.8-1.3-13.3-2.4-.6 2.6.5 5.4 3 6.8l38.8 22.4s2.4 1.6 4.2 1.6c1.8 0 3.4-1.6 3.4-1.6.8-.4 1.3-1 1.7-1.8l10-17.2-6.3.3c-1 0-2-.6-2-1.5-.2-.2-.2-.4-.2-.6 9-.3 27-2.8 29.3-9.5 1-2.7.6-6.5-6-9zm-48-13.7c-1-3 1-6 3.8-6.7 3-.7 6 1 6.7 4 1 3-1 6-3.8 6.7-3 .7-6-1-6.7-4zm15 40.3c-3 1-6-.8-6.7-3.7-1-3 1-6 3.8-6.7 3-.8 6 1 6.7 3.8.8 3-1 6-4 6.7zm13.7-23.6c-3 .8-6-1-6.7-4-.8-2.8 1-5.8 4-6.6 2.8-.7 5.8 1 6.6 4 .8 2.8-1 5.8-4 6.6z'/>        </symbol>        <symbol id='dh-save' viewBox='-4 -4 32 32'>          <path fill='currentColor' fill-rule='nonzero' d='M19 11h-14v-2h14v2zm0 2h-14v2h14v-2zm0 4h-14v2h14v-2zm3-11v16h-20v-16h20zm2-6h-24v24h24v-24z'/>        </symbol>      </svg>    "),o=navigator.platform&&(navigator.platform.toLowerCase().indexOf("mac")>=0||/iPad|iPhone|iPod/.test(navigator.platform));e=$("      <div class='dh-lottery"+(o?" is-mac":"")+"'></div>    ");var i=$("      <div id='dh-lottery-selector' style='display: none'>      </div>    "),s=$("      <div class='main-container'>        <canvas id='dh-confetti-canvas'></canvas>        <div class='userlist columns is-multiline is-mobile'></div>      </div>    "),l=$("      <div class='actions'>        <a class='button primary' id='dh-history-show'><i class='dh-icon dh-icon-dice'>ðŸ’¾<svg><use xlink:href='#dh-save'/></svg></i></a>        <a class='button primary' id='dh-lottery-go'>"+a+"</a>      </div>    "),d=$("      <div class='dh-animated dh-modal"+(o?" is-mac":"")+"' id='dh-lottery-winner'>        <div class='dh-modal-background'></div>        <div class='dh-modal-content'>        </div>        <button class='dh-modal-close'></button>      </div>    "),c=$("      <div class='dh-modal' id='dh-lottery-history'>        <div class='dh-modal-background'></div>        <div class='dh-modal-content'>        </div>        <button class='dh-modal-close'></button>        <button class='dh-history-clean dh-modal-btn'>Clean all</button>        <div class='dh-modal-config-number' >        <button class='dh-number-inc dh-modal-btn'>+</button>        <div class='dh-number dh-modal-btn'>1</div>        <button class='dh-number-dec dh-modal-btn'>-</button>        </div>      </div>    ");e.append(r),e.append(i),e.append(s),e.append(c),t.showbtn&&e.append(l),n.append(e),n.append(d),$("#dh-lottery-go").click(function(){return h?w():C()}),$("#dh-lottery-winner .dh-modal-close").click(function(){return $("#dh-lottery-winner").removeClass("is-active")}),$("#dh-lottery-history .dh-modal-close").click(function(){return $("#dh-lottery-history").removeClass("is-active")}),$("#dh-lottery-history .dh-history-clean").click(function(){x()}),$("#dh-lottery-history .dh-number-inc").click(function(){t.number<10&&(t.number+=1,localStorage.setItem("lotteryConfigNumber",t.number),$("#dh-lottery-history .dh-number").text(t.number))}),$("#dh-lottery-history .dh-number").click(function(){t.number=1,localStorage.setItem("lotteryConfigNumber",t.number),$("#dh-lottery-history .dh-number").text(t.number)}),$("#dh-lottery-history .dh-number-dec").click(function(){t.number>1&&(t.number-=1,localStorage.setItem("lotteryConfigNumber",t.number),$("#dh-lottery-history .dh-number").text(t.number))}),$("#dh-history-show").click(function(){k(),$("#dh-lottery-history .dh-number").text(t.number)}),document.body.onkeydown=function(e){if(27==e.keyCode)return $(".dh-modal-close").click();if(32==e.keyCode){if($("#dh-lottery-winner").hasClass("is-active"))return;return $("#dh-lottery-go").click()}if(70==e.keyCode){!function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen()}(document.documentElement)}}},s=function(){for(var e="",n=0;n<t.number;n++)e+="        <span class='image' id='selector_"+n+"'>          <div class='selector-border'></div>        </span>      ";$("#dh-lottery-selector").html(e),setTimeout(function(){u=y(),$("#dh-lottery-selector .image").show();for(var e=0;e<t.number;e++)g(e,0)},1e3)},l=function(e){var n='\n      <div class="column">\n        <div class="profile" data-profile="'+encodeURIComponent(JSON.stringify(e))+'">\n          <div class="profile__parent">\n              <div class="profile__wrapper">\n                <div class="profile__content">'+(e.avatar?'<div class="avatar"><span class="image avatar-image is-128x128"><img src="'+e.avatar+'" alt="avatar" /></span></div':'<div class="avatar"><span class="image dh-name-avatar avatar-image is-128x128">'+(e.data[t.title]||e.name)+"</span></div>")+"</div>\n              </div>\n          </div>\n        </div>\n      </div>\n    ";return $(".userlist").append(n)},d=function(){$.ajax({type:"GET",url:t.api,dataType:"json",success:function(e){t.data=e,console.log("Lottery: API data loaded"),c()},error:function(e,t){alert("Lottery: Load player list error!\n"+t+"\n"+t)}})},c=function(){t.$el=$(t.el),localStorage.getItem("lotteryHistory")&&(t.winnerHistory=JSON.parse(localStorage.getItem("lotteryHistory"))),i(t.$el),$.each(t.data,function(e,t){t.id=e,l(t)}),new MaterialAvatar(document.getElementsByClassName("dh-name-avatar"),r),console.log("Lottery: "+t.data.length+" player"),t.confetti&&window.readyConfetti()},u=[],m=[],h=null,v=null;$(window).resize(function(){u=y();for(var e in m)g(e,m[e])});var y=function(){return $.map($(".profile"),function(e,t){return o[t]=e,$(e).find(".avatar-image").first().position()})},f=function(e){var t=0;for(var n in e)t++;return t},p=function(e){var n,o,a,i=$("\n      <div class='profile-item'>\n        <div class='avatar-image'>\n          <h1><i class='dh-icon dh-icon-crown'>ðŸ‘‘<svg><use xlink:href='#dh-crown'/></svg></i></h1>\n          <div class='avatar'><span class='image avatar-image'><img src='' alt='avatar' /></span></div>\n        </div>\n        <h2 class='profile-name'></h2>\n        <h3 class='profile-subtitle'></h3>\n        <h4 class='profile-desc'></h4>\n      </div>\n    ");if(e){e.data&&Object.keys(e.data).length>0&&(o=e.data[t.title],n=e.data[t.subtitle],a=e.data[t.desc]);var s=o||e.name,l=n||e.company,d=a||"";e.avatar?i.find(".avatar-image img").attr("src",e.avatar):(i.find(".avatar-image img").remove(),i.find(".avatar-image").addClass("dh-name-avatar").text(s)),i.find(".profile-name").text(s),i.find(".profile-subtitle").text(l),i.find(".profile-desc").text(d)}$("#dh-lottery-winner .dh-modal-content").append(i),new MaterialAvatar(document.getElementsByClassName("dh-name-avatar"),r)},g=function(e,t){if($(o[t]).addClass("current"),u[t])return move("#dh-lottery-selector #selector_"+e).x(u[t].left-4).y(u[t].top-4).ease("in-out").duration(200).end(),m},b=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!(u<=0)){var r=Math.floor(Math.random()*u.length);if(t.once&&t.winnerList[r]||$.inArray(r,m)>=0)return console.log("Lottery: dup, next."),e(n),!1;g(n,r),m.push(r)}},w=function(){t.$el.removeClass("running-lottery"),console.log("Lottery: stoping..."),clearTimeout(v),$("#dh-lottery-winner .dh-modal-content").html(""),t.winners=[];for(var e=0;e<m.length;e++){var n=JSON.parse(decodeURIComponent($($(".profile")[m[e]]).data("profile"))),r=n.id;t.winners[r]=n,t.winnerList[r]=n,p(n)}$("#dh-lottery-winner .dh-modal-content").removeClass("dh-morewinner").removeClass("dh-solowinner"),$(".dh-modal-content .profile-item").css("font-size","50px"),m.length>3&&$("#dh-lottery-winner .dh-modal-content").addClass("dh-morewinner"),m.length<4&&$(".dh-modal-content .profile-item").css("font-size","70px"),m.length<2&&($(".dh-modal-content .profile-item").css("font-size","90px"),$("#dh-lottery-winner .dh-modal-content").addClass("dh-solowinner")),clearInterval(h),console.log("Lottery: Ignore user #",t.winnerList),t.confetti&&(window.startConfetti(),setTimeout(function(){return window.stopConfetti()},1500)),setTimeout(function(){return $("#dh-lottery-winner").addClass("is-active")},700),h=null,$("#dh-lottery-go").removeClass("success").addClass("primary").html(a);var o={};o.time=(new Date).toLocaleString(),o.winner={};for(var i in t.winners)o.winner[i]=t.winners[i];return t.winnerHistory.push(o),localStorage.setItem("lotteryHistory",JSON.stringify(t.winnerHistory)),n},C=function(){if(s(),t.once&&t.data.length-f(t.winnerList)<t.number)return alert("No user left to participate in lottery."),!1;console.log("Lottery: started"),t.$el.addClass("running-lottery"),$("#dh-lottery-winner").removeClass("is-active"),$("#dh-lottery-selector").show(),console.log("$('#dh-lottery-selector').show();");var e=function(){m=[],$(".dh-lottery .profile.current").removeClass("current");for(var e=0;e<t.number;e++)b(e);console.log("Lottery: moveToTarget #",m)};return e(),h=setInterval(e,t.speed),t.timeout&&(v=setTimeout(w,1e3*t.timeout)),$("#dh-lottery-go").removeClass("primary").addClass("success").html("<i class='dh-icon dh-icon-okay'>ðŸ‘Œ<svg><use xlink:href='#dh-okay'/></svg></i>"),!0},x=function(){return 1==confirm("Delete Lottery History. Sure?")&&(localStorage.setItem("lotteryHistory",""),t.winnerHistory=[],$("#dh-lottery-history .dh-modal-content").html(""),!0)},k=function(){var e=$("#dh-lottery-history .dh-modal-content");e.html("");var n=t.winnerHistory.reverse();for(var o in n){(s=n[o]).number=f(s.winner),s.i=Number(o)+1;var a=$(function(e){return"\n      <div class='dh-history-item'>\n        <div class='dh-history-info'>\n          <h1>"+e.i+"</h1>\n          <p>"+e.time+"</p>\n        </div>\n        <div class='dh-history-user'>\n        </div>\n      </div>\n    "}(s));for(var i in s.winner){var s=n[o].winner[i],l=$(function(e){return"\n      <div>\n        "+(e.avatar?'<div class="avatar"><span class="image avatar-image is-128x128"><img src="'+e.avatar+'" alt="avatar" /></span></div':'<div class="avatar"><span class="image dh-name-avatar avatar-image is-128x128">'+(e.data[t.title]||e.name)+"</span></div>")+"\n        <h3 class='name'>"+(e.data[t.title]||e.name)+"</h3>\n      </div>\n    "}(s));a.find(".dh-history-user").append(l)}e.append(a)}return $("#dh-lottery-history").addClass("is-active"),new MaterialAvatar(document.getElementsByClassName("dh-name-avatar"),r),t.winnerHistory},z={init:function(e){null!=(t=$.extend({},n,e)).api?d(t.api):c(),!e.number&&localStorage.lotteryConfigNumber&&(t.number=parseInt(localStorage.lotteryConfigNumber)||1)},start:function(){return C()},stop:function(){return w()},getUsers:function(){return t.data},winners:function(e){switch(e){case"get":return t.winners;case"clean":return t.winnerList=[],!0;default:console.error("Action "+e+" does not exist.")}},history:function(e){switch(e){case"show":return k();case"get":return t.winnerHistory;case"clean":return x();default:console.error("Action "+e+" does not exist.")}}};$.lottery=function(e){return z[e]?z[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==(void 0===e?"undefined":_typeof(e))&&e?void console.error("Method "+e+" does not exist."):z.init.apply(this,arguments)}}();